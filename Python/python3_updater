#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20160705

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	WEB=https://www.python.org/downloads/
	#VERSION=`curl -s $WEB | grep .tar.xz | head -1 | cut -d "-" -f2 | cut -d "t" -f-1 | sed "s/.$//g"`
	VERSION=3.5.2
	PRGNAM=python3
	echo -ne "\033]2;${PRGNAM}_updater\007"
	PRGNAM2=Python
	PYVER=$(cut -d. -f1,2 <<< "$VERSION")
	SITEPK=$PKG/usr/lib${LIBDIRSUFFIX}/python${PYVER}/site-packages
	TOOLSDIR=/usr/lib${LIBDIRSUFFIX}/python${PYVER}/site-packages
	EXTENSION=tar.xz
	SOURCES=$PRGNAM2-$VERSION.$EXTENSION
	DOWNLOAD=https://www.python.org/ftp/python/$VERSION/$SOURCES
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
cd $PRGNAM2-$VERSION

# Parcheamos
echo "
ZGlmZiAtdWFyIFB5dGhvbi0zLjUuMC5vcmlnL01ha2VmaWxlLnByZS5pbiBQeXRob24tMy41LjAv
TWFrZWZpbGUucHJlLmluCi0tLSBQeXRob24tMy41LjAub3JpZy9NYWtlZmlsZS5wcmUuaW4JMjAx
NS0wOS0xMyAxNDo0MToyMy4wMDAwMDAwMDAgKzAzMDAKKysrIFB5dGhvbi0zLjUuMC9NYWtlZmls
ZS5wcmUuaW4JMjAxNS0xMC0yNSAxNjozMzo1Ni4xOTExMzAyNjkgKzAyMDAKQEAgLTU0OSw3ICs1
NDksNyBAQAogCSQoUlVOU0hBUkVEKSAkKFBZVEhPTl9GT1JfQlVJTEQpIC4vVG9vbHMvY2xpbmlj
L2NsaW5pYy5weSAtLW1ha2UKIAogIyBCdWlsZCB0aGUgaW50ZXJwcmV0ZXIKLSQoQlVJTERQWVRI
T04pOglQcm9ncmFtcy9weXRob24ubyAkKExJQlJBUlkpICQoTERMSUJSQVJZKSAkKFBZM0xJQlJB
UlkpCiskKEJVSUxEUFlUSE9OKToJUHJvZ3JhbXMvcHl0aG9uLm8gJChMRExJQlJBUlkpICQoUFkz
TElCUkFSWSkKIAkkKExJTktDQykgJChQWV9MREZMQUdTKSAkKExJTktGT1JTSEFSRUQpIC1vICRA
IFByb2dyYW1zL3B5dGhvbi5vICQoQkxETElCUkFSWSkgJChMSUJTKSAkKE1PRExJQlMpICQoU1lT
TElCUykgJChMRExBU1QpCiAKIHBsYXRmb3JtOiAkKEJVSUxEUFlUSE9OKSBweWJ1aWxkZGlyLnR4
dApAQCAtNTg0LDE4ICs1ODQsNiBAQAogCQlfVENMVEtfSU5DTFVERVM9JyQoVENMVEtfSU5DTFVE
RVMpJyBfVENMVEtfTElCUz0nJChUQ0xUS19MSUJTKScgXAogCQkkKFBZVEhPTl9GT1JfQlVJTEQp
ICQoc3JjZGlyKS9zZXR1cC5weSAkJHF1aWV0IGJ1aWxkCiAKLSMgQnVpbGQgc3RhdGljIGxpYnJh
cnkKLSMgYXZvaWQgbG9uZyBjb21tYW5kIGxpbmVzLCBzYW1lIGFzIExJQlJBUllfT0JKUwotJChM
SUJSQVJZKTogJChMSUJSQVJZX09CSlMpCi0JLXJtIC1mICRACi0JJChBUikgJChBUkZMQUdTKSAk
QCBNb2R1bGVzL2dldGJ1aWxkaW5mby5vCi0JJChBUikgJChBUkZMQUdTKSAkQCAkKFBBUlNFUl9P
QkpTKQotCSQoQVIpICQoQVJGTEFHUykgJEAgJChPQkpFQ1RfT0JKUykKLQkkKEFSKSAkKEFSRkxB
R1MpICRAICQoUFlUSE9OX09CSlMpIFB5dGhvbi9mcm96ZW4ubwotCSQoQVIpICQoQVJGTEFHUykg
JEAgJChNT0RVTEVfT0JKUykgJChTSUdOQUxfT0JKUykKLQkkKEFSKSAkKEFSRkxBR1MpICRAICQo
TU9ET0JKUykKLQkkKFJBTkxJQikgJEAKLQogbGlicHl0aG9uJChMRFZFUlNJT04pLnNvOiAkKExJ
QlJBUllfT0JKUykKIAlpZiB0ZXN0ICQoSU5TVFNPTkFNRSkgIT0gJChMRExJQlJBUlkpOyB0aGVu
IFwKIAkJJChCTERTSEFSRUQpIC1XbCwtaCQoSU5TVFNPTkFNRSkgLW8gJChJTlNUU09OQU1FKSAk
KExJQlJBUllfT0JKUykgJChNT0RMSUJTKSAkKFNITElCUykgJChMSUJDKSAkKExJQk0pICQoTERM
QVNUKTsgXApAQCAtNjg1LDcgKzY3Myw3IEBACiAJCWVjaG8gIi0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIjsgXAogCWZpCiAKLVByb2dyYW1zL190ZXN0ZW1i
ZWQ6IFByb2dyYW1zL190ZXN0ZW1iZWQubyAkKExJQlJBUlkpICQoTERMSUJSQVJZKSAkKFBZM0xJ
QlJBUlkpCitQcm9ncmFtcy9fdGVzdGVtYmVkOiBQcm9ncmFtcy9fdGVzdGVtYmVkLm8gJChMRExJ
QlJBUlkpICQoUFkzTElCUkFSWSkKIAkkKExJTktDQykgJChQWV9MREZMQUdTKSAkKExJTktGT1JT
SEFSRUQpIC1vICRAIFByb2dyYW1zL190ZXN0ZW1iZWQubyAkKEJMRExJQlJBUlkpICQoTElCUykg
JChNT0RMSUJTKSAkKFNZU0xJQlMpICQoTERMQVNUKQogCiAjIyMjIyMjIyMjIyMjIyMjIyMjIyMj
IyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCkBA
IC0xMzU3LDE4ICsxMzQ1LDYgQEAKIAkJZWxzZQl0cnVlOyBcCiAJCWZpOyBcCiAJZG9uZQotCUBp
ZiB0ZXN0IC1kICQoTElCUkFSWSk7IHRoZW4gOjsgZWxzZSBcCi0JCWlmIHRlc3QgIiQoUFlUSE9O
RlJBTUVXT1JLRElSKSIgPSBuby1mcmFtZXdvcms7IHRoZW4gXAotCQkJaWYgdGVzdCAiJChTSExJ
Ql9TVUZGSVgpIiA9IC5kbGw7IHRoZW4gXAotCQkJCSQoSU5TVEFMTF9EQVRBKSAkKExETElCUkFS
WSkgJChERVNURElSKSQoTElCUEwpIDsgXAotCQkJZWxzZSBcCi0JCQkJJChJTlNUQUxMX0RBVEEp
ICQoTElCUkFSWSkgJChERVNURElSKSQoTElCUEwpLyQoTElCUkFSWSkgOyBcCi0JCQkJJChSQU5M
SUIpICQoREVTVERJUikkKExJQlBMKS8kKExJQlJBUlkpIDsgXAotCQkJZmk7IFwKLQkJZWxzZSBc
Ci0JCQllY2hvIFNraXAgaW5zdGFsbCBvZiAkKExJQlJBUlkpIC0gdXNlIG1ha2UgZnJhbWV3b3Jr
aW5zdGFsbDsgXAotCQlmaTsgXAotCWZpCiAJJChJTlNUQUxMX0RBVEEpIE1vZHVsZXMvY29uZmln
LmMgJChERVNURElSKSQoTElCUEwpL2NvbmZpZy5jCiAJJChJTlNUQUxMX0RBVEEpIFByb2dyYW1z
L3B5dGhvbi5vICQoREVTVERJUikkKExJQlBMKS9weXRob24ubwogCSQoSU5TVEFMTF9EQVRBKSAk
KHNyY2RpcikvTW9kdWxlcy9jb25maWcuYy5pbiAkKERFU1RESVIpJChMSUJQTCkvY29uZmlnLmMu
aW4K" | base64 -d > $TMP/python3.no-static-library.diff

patch -p1 -i $TMP/python3.no-static-library.diff || exit 1

echo "
LS0tIC4vTW9kdWxlcy9yZWFkbGluZS5jLm9yaWcJMjAwOS0xMC0yNiAyMTozMjo1MS4wMDAwMDAw
MDAgKzAyMDAKKysrIC4vTW9kdWxlcy9yZWFkbGluZS5jCTIwMTAtMDUtMzAgMTQ6MDc6MTAuMDAw
MDAwMDAwICswMzAwCkBAIC0xMiw2ICsxMiw5IEBACiAjaW5jbHVkZSA8ZXJybm8uaD4KICNpbmNs
dWRlIDxzeXMvdGltZS5oPgogCisvKiBUaGlzIHNlZW1zIHRvIGJlIG5lZWRlZCBmb3Igc2V0X3By
ZV9pbnB1dF9ob29rIHRvIHdvcmsgKi8KKyNkZWZpbmUgSEFWRV9STF9QUkVfSU5QVVRfSE9PSyAx
CisKICNpZiBkZWZpbmVkKEhBVkVfU0VUTE9DQUxFKQogLyogR05VIHJlYWRsaW5lKCkgbWlzdGFr
ZW5seSBzZXRzIHRoZSBMQ19DVFlQRSBsb2NhbGUuCiAgKiBUaGlzIGlzIGV2aWwuICBPbmx5IHRo
ZSB1c2VyIG9yIHRoZSBhcHAncyBtYWluKCkgc2hvdWxkIGRvIHRoaXMhCg==
" | base64 -d > $TMP/python3.readline.set_pre_input_hook.diff

patch -p1 -i $TMP/python3.readline.set_pre_input_hook.diff || exit 1

if [ "$ARCH" = "x86_64" ]; then
echo "ZGlmZiAtdWFyIFB5dGhvbi0zLjUuMS5vcmlnL0xpYi9kaXN0dXRpbHMvY29tbWFuZC9pbnN0YWxs
LnB5IFB5dGhvbi0zLjUuMS9MaWIvZGlzdHV0aWxzL2NvbW1hbmQvaW5zdGFsbC5weQotLS0gUHl0
aG9uLTMuNS4xLm9yaWcvTGliL2Rpc3R1dGlscy9jb21tYW5kL2luc3RhbGwucHkJMjAxNS0xMi0w
NyAwMzozOTowNy4wMDAwMDAwMDAgKzAyMDAKKysrIFB5dGhvbi0zLjUuMS9MaWIvZGlzdHV0aWxz
L2NvbW1hbmQvaW5zdGFsbC5weQkyMDE1LTEyLTE0IDIxOjI3OjQ2LjA4MzQwMDM5NSArMDIwMApA
QCAtMjksMTUgKzI5LDE1IEBACiAKIElOU1RBTExfU0NIRU1FUyA9IHsKICAgICAndW5peF9wcmVm
aXgnOiB7Ci0gICAgICAgICdwdXJlbGliJzogJyRiYXNlL2xpYi9weXRob24kcHlfdmVyc2lvbl9z
aG9ydC9zaXRlLXBhY2thZ2VzJywKLSAgICAgICAgJ3BsYXRsaWInOiAnJHBsYXRiYXNlL2xpYi9w
eXRob24kcHlfdmVyc2lvbl9zaG9ydC9zaXRlLXBhY2thZ2VzJywKKyAgICAgICAgJ3B1cmVsaWIn
OiAnJGJhc2UvbGliNjQvcHl0aG9uJHB5X3ZlcnNpb25fc2hvcnQvc2l0ZS1wYWNrYWdlcycsCisg
ICAgICAgICdwbGF0bGliJzogJyRwbGF0YmFzZS9saWI2NC9weXRob24kcHlfdmVyc2lvbl9zaG9y
dC9zaXRlLXBhY2thZ2VzJywKICAgICAgICAgJ2hlYWRlcnMnOiAnJGJhc2UvaW5jbHVkZS9weXRo
b24kcHlfdmVyc2lvbl9zaG9ydCRhYmlmbGFncy8kZGlzdF9uYW1lJywKICAgICAgICAgJ3Njcmlw
dHMnOiAnJGJhc2UvYmluJywKICAgICAgICAgJ2RhdGEnICAgOiAnJGJhc2UnLAogICAgICAgICB9
LAogICAgICd1bml4X2hvbWUnOiB7Ci0gICAgICAgICdwdXJlbGliJzogJyRiYXNlL2xpYi9weXRo
b24nLAotICAgICAgICAncGxhdGxpYic6ICckYmFzZS9saWIvcHl0aG9uJywKKyAgICAgICAgJ3B1
cmVsaWInOiAnJGJhc2UvbGliNjQvcHl0aG9uJywKKyAgICAgICAgJ3BsYXRsaWInOiAnJGJhc2Uv
bGliNjQvcHl0aG9uJywKICAgICAgICAgJ2hlYWRlcnMnOiAnJGJhc2UvaW5jbHVkZS9weXRob24v
JGRpc3RfbmFtZScsCiAgICAgICAgICdzY3JpcHRzJzogJyRiYXNlL2JpbicsCiAgICAgICAgICdk
YXRhJyAgIDogJyRiYXNlJywKZGlmZiAtdWFyIFB5dGhvbi0zLjUuMS5vcmlnL0xpYi9kaXN0dXRp
bHMvc3lzY29uZmlnLnB5IFB5dGhvbi0zLjUuMS9MaWIvZGlzdHV0aWxzL3N5c2NvbmZpZy5weQot
LS0gUHl0aG9uLTMuNS4xLm9yaWcvTGliL2Rpc3R1dGlscy9zeXNjb25maWcucHkJMjAxNS0xMi0w
NyAwMzozOTowNy4wMDAwMDAwMDAgKzAyMDAKKysrIFB5dGhvbi0zLjUuMS9MaWIvZGlzdHV0aWxz
L3N5c2NvbmZpZy5weQkyMDE1LTEyLTE0IDIxOjI3OjQ2LjA4MzQwMDM5NSArMDIwMApAQCAtMTMz
LDcgKzEzMyw3IEBACiAKICAgICBpZiBvcy5uYW1lID09ICJwb3NpeCI6CiAgICAgICAgIGxpYnB5
dGhvbiA9IG9zLnBhdGguam9pbihwcmVmaXgsCi0gICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAibGliIiwgInB5dGhvbiIgKyBnZXRfcHl0aG9uX3ZlcnNpb24oKSkKKyAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICJsaWI2NCIsICJweXRob24iICsgZ2V0X3B5dGhvbl92ZXJz
aW9uKCkpCiAgICAgICAgIGlmIHN0YW5kYXJkX2xpYjoKICAgICAgICAgICAgIHJldHVybiBsaWJw
eXRob24KICAgICAgICAgZWxzZToKZGlmZiAtdWFyIFB5dGhvbi0zLjUuMS5vcmlnL0xpYi9zaXRl
LnB5IFB5dGhvbi0zLjUuMS9MaWIvc2l0ZS5weQotLS0gUHl0aG9uLTMuNS4xLm9yaWcvTGliL3Np
dGUucHkJMjAxNS0xMi0wNyAwMzozOTowOC4wMDAwMDAwMDAgKzAyMDAKKysrIFB5dGhvbi0zLjUu
MS9MaWIvc2l0ZS5weQkyMDE1LTEyLTE0IDIxOjI3OjQ2LjA4MzQwMDM5NSArMDIwMApAQCAtMzAz
LDcgKzMwMyw3IEBACiAgICAgICAgIHNlZW4uYWRkKHByZWZpeCkKIAogICAgICAgICBpZiBvcy5z
ZXAgPT0gJy8nOgotICAgICAgICAgICAgc2l0ZXBhY2thZ2VzLmFwcGVuZChvcy5wYXRoLmpvaW4o
cHJlZml4LCAibGliIiwKKyAgICAgICAgICAgIHNpdGVwYWNrYWdlcy5hcHBlbmQob3MucGF0aC5q
b2luKHByZWZpeCwgImxpYjY0IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAicHl0aG9uIiArIHN5cy52ZXJzaW9uWzozXSwKICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAic2l0ZS1wYWNrYWdlcyIpKQogICAgICAgICBlbHNlOgpkaWZmIC11
YXIgUHl0aG9uLTMuNS4xLm9yaWcvTGliL3N5c2NvbmZpZy5weSBQeXRob24tMy41LjEvTGliL3N5
c2NvbmZpZy5weQotLS0gUHl0aG9uLTMuNS4xLm9yaWcvTGliL3N5c2NvbmZpZy5weQkyMDE1LTEy
LTA3IDAzOjM5OjA4LjAwMDAwMDAwMCArMDIwMAorKysgUHl0aG9uLTMuNS4xL0xpYi9zeXNjb25m
aWcucHkJMjAxNS0xMi0xNCAyMToyNzo0Ni4wODQ0MDA0MjkgKzAyMDAKQEAgLTIwLDEwICsyMCwx
MCBAQAogCiBfSU5TVEFMTF9TQ0hFTUVTID0gewogICAgICdwb3NpeF9wcmVmaXgnOiB7Ci0gICAg
ICAgICdzdGRsaWInOiAne2luc3RhbGxlZF9iYXNlfS9saWIvcHl0aG9ue3B5X3ZlcnNpb25fc2hv
cnR9JywKLSAgICAgICAgJ3BsYXRzdGRsaWInOiAne3BsYXRiYXNlfS9saWIvcHl0aG9ue3B5X3Zl
cnNpb25fc2hvcnR9JywKLSAgICAgICAgJ3B1cmVsaWInOiAne2Jhc2V9L2xpYi9weXRob257cHlf
dmVyc2lvbl9zaG9ydH0vc2l0ZS1wYWNrYWdlcycsCi0gICAgICAgICdwbGF0bGliJzogJ3twbGF0
YmFzZX0vbGliL3B5dGhvbntweV92ZXJzaW9uX3Nob3J0fS9zaXRlLXBhY2thZ2VzJywKKyAgICAg
ICAgJ3N0ZGxpYic6ICd7aW5zdGFsbGVkX2Jhc2V9L2xpYjY0L3B5dGhvbntweV92ZXJzaW9uX3No
b3J0fScsCisgICAgICAgICdwbGF0c3RkbGliJzogJ3twbGF0YmFzZX0vbGliNjQvcHl0aG9ue3B5
X3ZlcnNpb25fc2hvcnR9JywKKyAgICAgICAgJ3B1cmVsaWInOiAne2Jhc2V9L2xpYjY0L3B5dGhv
bntweV92ZXJzaW9uX3Nob3J0fS9zaXRlLXBhY2thZ2VzJywKKyAgICAgICAgJ3BsYXRsaWInOiAn
e3BsYXRiYXNlfS9saWI2NC9weXRob257cHlfdmVyc2lvbl9zaG9ydH0vc2l0ZS1wYWNrYWdlcycs
CiAgICAgICAgICdpbmNsdWRlJzoKICAgICAgICAgICAgICd7aW5zdGFsbGVkX2Jhc2V9L2luY2x1
ZGUvcHl0aG9ue3B5X3ZlcnNpb25fc2hvcnR9e2FiaWZsYWdzfScsCiAgICAgICAgICdwbGF0aW5j
bHVkZSc6CkBAIC0zMiwxMCArMzIsMTAgQEAKICAgICAgICAgJ2RhdGEnOiAne2Jhc2V9JywKICAg
ICAgICAgfSwKICAgICAncG9zaXhfaG9tZSc6IHsKLSAgICAgICAgJ3N0ZGxpYic6ICd7aW5zdGFs
bGVkX2Jhc2V9L2xpYi9weXRob24nLAotICAgICAgICAncGxhdHN0ZGxpYic6ICd7YmFzZX0vbGli
L3B5dGhvbicsCi0gICAgICAgICdwdXJlbGliJzogJ3tiYXNlfS9saWIvcHl0aG9uJywKLSAgICAg
ICAgJ3BsYXRsaWInOiAne2Jhc2V9L2xpYi9weXRob24nLAorICAgICAgICAnc3RkbGliJzogJ3tp
bnN0YWxsZWRfYmFzZX0vbGliNjQvcHl0aG9uJywKKyAgICAgICAgJ3BsYXRzdGRsaWInOiAne2Jh
c2V9L2xpYjY0L3B5dGhvbicsCisgICAgICAgICdwdXJlbGliJzogJ3tiYXNlfS9saWI2NC9weXRo
b24nLAorICAgICAgICAncGxhdGxpYic6ICd7YmFzZX0vbGliNjQvcHl0aG9uJywKICAgICAgICAg
J2luY2x1ZGUnOiAne2luc3RhbGxlZF9iYXNlfS9pbmNsdWRlL3B5dGhvbicsCiAgICAgICAgICdw
bGF0aW5jbHVkZSc6ICd7aW5zdGFsbGVkX2Jhc2V9L2luY2x1ZGUvcHl0aG9uJywKICAgICAgICAg
J3NjcmlwdHMnOiAne2Jhc2V9L2JpbicsCkBAIC02MSwxMCArNjEsMTAgQEAKICAgICAgICAgJ2Rh
dGEnOiAne3VzZXJiYXNlfScsCiAgICAgICAgIH0sCiAgICAgJ3Bvc2l4X3VzZXInOiB7Ci0gICAg
ICAgICdzdGRsaWInOiAne3VzZXJiYXNlfS9saWIvcHl0aG9ue3B5X3ZlcnNpb25fc2hvcnR9JywK
LSAgICAgICAgJ3BsYXRzdGRsaWInOiAne3VzZXJiYXNlfS9saWIvcHl0aG9ue3B5X3ZlcnNpb25f
c2hvcnR9JywKLSAgICAgICAgJ3B1cmVsaWInOiAne3VzZXJiYXNlfS9saWIvcHl0aG9ue3B5X3Zl
cnNpb25fc2hvcnR9L3NpdGUtcGFja2FnZXMnLAotICAgICAgICAncGxhdGxpYic6ICd7dXNlcmJh
c2V9L2xpYi9weXRob257cHlfdmVyc2lvbl9zaG9ydH0vc2l0ZS1wYWNrYWdlcycsCisgICAgICAg
ICdzdGRsaWInOiAne3VzZXJiYXNlfS9saWI2NC9weXRob257cHlfdmVyc2lvbl9zaG9ydH0nLAor
ICAgICAgICAncGxhdHN0ZGxpYic6ICd7dXNlcmJhc2V9L2xpYjY0L3B5dGhvbntweV92ZXJzaW9u
X3Nob3J0fScsCisgICAgICAgICdwdXJlbGliJzogJ3t1c2VyYmFzZX0vbGliNjQvcHl0aG9ue3B5
X3ZlcnNpb25fc2hvcnR9L3NpdGUtcGFja2FnZXMnLAorICAgICAgICAncGxhdGxpYic6ICd7dXNl
cmJhc2V9L2xpYjY0L3B5dGhvbntweV92ZXJzaW9uX3Nob3J0fS9zaXRlLXBhY2thZ2VzJywKICAg
ICAgICAgJ2luY2x1ZGUnOiAne3VzZXJiYXNlfS9pbmNsdWRlL3B5dGhvbntweV92ZXJzaW9uX3No
b3J0fScsCiAgICAgICAgICdzY3JpcHRzJzogJ3t1c2VyYmFzZX0vYmluJywKICAgICAgICAgJ2Rh
dGEnOiAne3VzZXJiYXNlfScsCmRpZmYgLXVhciBQeXRob24tMy41LjEub3JpZy9NYWtlZmlsZS5w
cmUuaW4gUHl0aG9uLTMuNS4xL01ha2VmaWxlLnByZS5pbgotLS0gUHl0aG9uLTMuNS4xLm9yaWcv
TWFrZWZpbGUucHJlLmluCTIwMTUtMTItMDcgMDM6Mzk6MDkuMDAwMDAwMDAwICswMjAwCisrKyBQ
eXRob24tMy41LjEvTWFrZWZpbGUucHJlLmluCTIwMTUtMTItMTQgMjE6Mjc6NDYuMDg0NDAwNDI5
ICswMjAwCkBAIC0xMjUsNyArMTI1LDcgQEAKIE1BTkRJUj0JCUBtYW5kaXJACiBJTkNMVURFRElS
PQlAaW5jbHVkZWRpckAKIENPTkZJTkNMVURFRElSPQkkKGV4ZWNfcHJlZml4KS9pbmNsdWRlCi1T
Q1JJUFRESVI9CSQocHJlZml4KS9saWIKK1NDUklQVERJUj0JJChwcmVmaXgpL2xpYjY0CiBBQklG
TEFHUz0JQEFCSUZMQUdTQAogCiAjIERldGFpbGVkIGRlc3RpbmF0aW9uIGRpcmVjdG9yaWVzCmRp
ZmYgLXVhciBQeXRob24tMy41LjEub3JpZy9Nb2R1bGVzL2dldHBhdGguYyBQeXRob24tMy41LjEv
TW9kdWxlcy9nZXRwYXRoLmMKLS0tIFB5dGhvbi0zLjUuMS5vcmlnL01vZHVsZXMvZ2V0cGF0aC5j
CTIwMTUtMTItMDcgMDM6Mzk6MTAuMDAwMDAwMDAwICswMjAwCisrKyBQeXRob24tMy41LjEvTW9k
dWxlcy9nZXRwYXRoLmMJMjAxNS0xMi0xNCAyMToyNzo0Ni4wODU0MDA0NjMgKzAyMDAKQEAgLTEx
OCw4ICsxMTgsOCBAQAogI2VuZGlmCiAKICNpZm5kZWYgUFlUSE9OUEFUSAotI2RlZmluZSBQWVRI
T05QQVRIIFBSRUZJWCAiL2xpYi9weXRob24iIFZFUlNJT04gIjoiIFwKLSAgICAgICAgICAgICAg
RVhFQ19QUkVGSVggIi9saWIvcHl0aG9uIiBWRVJTSU9OICIvbGliLWR5bmxvYWQiCisjZGVmaW5l
IFBZVEhPTlBBVEggUFJFRklYICIvbGliNjQvcHl0aG9uIiBWRVJTSU9OICI6IiBcCisgICAgICAg
ICAgICAgIEVYRUNfUFJFRklYICIvbGliNjQvcHl0aG9uIiBWRVJTSU9OICIvbGliLWR5bmxvYWQi
CiAjZW5kaWYKIAogI2lmbmRlZiBMQU5ETUFSSwpAQCAtNTExLDcgKzUxMSw3IEBACiAgICAgX3B5
dGhvbnBhdGggPSBQeV9EZWNvZGVMb2NhbGUoUFlUSE9OUEFUSCwgTlVMTCk7CiAgICAgX3ByZWZp
eCA9IFB5X0RlY29kZUxvY2FsZShQUkVGSVgsIE5VTEwpOwogICAgIF9leGVjX3ByZWZpeCA9IFB5
X0RlY29kZUxvY2FsZShFWEVDX1BSRUZJWCwgTlVMTCk7Ci0gICAgbGliX3B5dGhvbiA9IFB5X0Rl
Y29kZUxvY2FsZSgibGliL3B5dGhvbiIgVkVSU0lPTiwgTlVMTCk7CisgICAgbGliX3B5dGhvbiA9
IFB5X0RlY29kZUxvY2FsZSgibGliNjQvcHl0aG9uIiBWRVJTSU9OLCBOVUxMKTsKIAogICAgIGlm
ICghX3B5dGhvbnBhdGggfHwgIV9wcmVmaXggfHwgIV9leGVjX3ByZWZpeCB8fCAhbGliX3B5dGhv
bikgewogICAgICAgICBQeV9GYXRhbEVycm9yKApAQCAtNzAwLDcgKzcwMCw3IEBACiAgICAgfQog
ICAgIGVsc2UKICAgICAgICAgd2NzbmNweSh6aXBfcGF0aCwgX3ByZWZpeCwgTUFYUEFUSExFTik7
Ci0gICAgam9pbnBhdGgoemlwX3BhdGgsIEwibGliL3B5dGhvbjAwLnppcCIpOworICAgIGpvaW5w
YXRoKHppcF9wYXRoLCBMImxpYjY0L3B5dGhvbjAwLnppcCIpOwogICAgIGJ1ZnN6ID0gd2NzbGVu
KHppcF9wYXRoKTsgICAvKiBSZXBsYWNlICIwMCIgd2l0aCB2ZXJzaW9uICovCiAgICAgemlwX3Bh
dGhbYnVmc3ogLSA2XSA9IFZFUlNJT05bMF07CiAgICAgemlwX3BhdGhbYnVmc3ogLSA1XSA9IFZF
UlNJT05bMl07CkBAIC03MTIsNyArNzEyLDcgQEAKICAgICAgICAgICAgIGZwcmludGYoc3RkZXJy
LAogICAgICAgICAgICAgICAgICJDb3VsZCBub3QgZmluZCBwbGF0Zm9ybSBkZXBlbmRlbnQgbGli
cmFyaWVzIDxleGVjX3ByZWZpeD5cbiIpOwogICAgICAgICB3Y3NuY3B5KGV4ZWNfcHJlZml4LCBf
ZXhlY19wcmVmaXgsIE1BWFBBVEhMRU4pOwotICAgICAgICBqb2lucGF0aChleGVjX3ByZWZpeCwg
TCJsaWIvbGliLWR5bmxvYWQiKTsKKyAgICAgICAgam9pbnBhdGgoZXhlY19wcmVmaXgsIEwibGli
NjQvbGliLWR5bmxvYWQiKTsKICAgICB9CiAgICAgLyogSWYgd2UgZm91bmQgRVhFQ19QUkVGSVgg
ZG8gKm5vdCogcmVkdWNlIGl0ISAgKFlldC4pICovCiAKZGlmZiAtdWFyIFB5dGhvbi0zLjUuMS5v
cmlnL2NvbmZpZ3VyZSBQeXRob24tMy41LjEvY29uZmlndXJlCi0tLSBQeXRob24tMy41LjEub3Jp
Zy9jb25maWd1cmUJMjAxNS0xMi0wNyAwMzozOToxMS4wMDAwMDAwMDAgKzAyMDAKKysrIFB5dGhv
bi0zLjUuMS9jb25maWd1cmUJMjAxNS0xMi0xNCAyMToyNzo0Ni4wODk0MDA1OTggKzAyMDAKQEAg
LTE0NDY0LDcgKzE0NDY0LDcgQEAKICRhc19lY2hvICIkTERWRVJTSU9OIiA+JjY7IH0KIAogCi1M
SUJQTD0nJChwcmVmaXgpJyIvbGliL3B5dGhvbiR7VkVSU0lPTn0vY29uZmlnLSR7TERWRVJTSU9O
fSIKK0xJQlBMPSckKHByZWZpeCknIi9saWI2NC9weXRob24ke1ZFUlNJT059L2NvbmZpZy0ke0xE
VkVSU0lPTn0iCiAKIAogIyBDaGVjayB3aGV0aGVyIHJpZ2h0IHNoaWZ0aW5nIGEgbmVnYXRpdmUg
aW50ZWdlciBleHRlbmRzIHRoZSBzaWduIGJpdApkaWZmIC11YXIgUHl0aG9uLTMuNS4xLm9yaWcv
c2V0dXAucHkgUHl0aG9uLTMuNS4xL3NldHVwLnB5Ci0tLSBQeXRob24tMy41LjEub3JpZy9zZXR1
cC5weQkyMDE1LTEyLTA3IDAzOjM5OjExLjAwMDAwMDAwMCArMDIwMAorKysgUHl0aG9uLTMuNS4x
L3NldHVwLnB5CTIwMTUtMTItMTQgMjE6Mjc6NDYuMDkwNDAwNjMyICswMjAwCkBAIC00NjksNyAr
NDY5LDcgQEAKICAgICAgICAgIyBkaXJlY3RvcmllcyAoaS5lLiAnLicgYW5kICdJbmNsdWRlJykg
bXVzdCBiZSBmaXJzdC4gIFNlZSBpc3N1ZQogICAgICAgICAjIDEwNTIwLgogICAgICAgICBpZiBu
b3QgY3Jvc3NfY29tcGlsaW5nOgotICAgICAgICAgICAgYWRkX2Rpcl90b19saXN0KHNlbGYuY29t
cGlsZXIubGlicmFyeV9kaXJzLCAnL3Vzci9sb2NhbC9saWInKQorICAgICAgICAgICAgYWRkX2Rp
cl90b19saXN0KHNlbGYuY29tcGlsZXIubGlicmFyeV9kaXJzLCAnL3Vzci9sb2NhbC9saWI2NCcp
CiAgICAgICAgICAgICBhZGRfZGlyX3RvX2xpc3Qoc2VsZi5jb21waWxlci5pbmNsdWRlX2RpcnMs
ICcvdXNyL2xvY2FsL2luY2x1ZGUnKQogICAgICAgICAjIG9ubHkgY2hhbmdlIHRoaXMgZm9yIGNy
b3NzIGJ1aWxkcyBmb3IgMy4zLCBpc3N1ZXMgb24gTWFnZWlhCiAgICAgICAgIGlmIGNyb3NzX2Nv
bXBpbGluZzoKQEAgLTc1MCwxMSArNzUwLDExIEBACiAgICAgICAgICAgICBlbGlmIGN1cnNlc19s
aWJyYXJ5OgogICAgICAgICAgICAgICAgIHJlYWRsaW5lX2xpYnMuYXBwZW5kKGN1cnNlc19saWJy
YXJ5KQogICAgICAgICAgICAgZWxpZiBzZWxmLmNvbXBpbGVyLmZpbmRfbGlicmFyeV9maWxlKGxp
Yl9kaXJzICsKLSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgWycvdXNyL2xpYi90ZXJtY2FwJ10sCisgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgIFsnL3Vzci9saWI2NC90ZXJtY2FwJ10sCiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXJtY2FwJyk6
CiAgICAgICAgICAgICAgICAgcmVhZGxpbmVfbGlicy5hcHBlbmQoJ3Rlcm1jYXAnKQogICAgICAg
ICAgICAgZXh0cy5hcHBlbmQoIEV4dGVuc2lvbigncmVhZGxpbmUnLCBbJ3JlYWRsaW5lLmMnXSwK
LSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyeV9kaXJzPVsnL3Vzci9s
aWIvdGVybWNhcCddLAorICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaWJyYXJ5
X2RpcnM9WycvdXNyL2xpYjY0L3Rlcm1jYXAnXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgZXh0cmFfbGlua19hcmdzPXJlYWRsaW5lX2V4dHJhX2xpbmtfYXJncywKICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGlicmFyaWVzPXJlYWRsaW5lX2xpYnMpICkK
ICAgICAgICAgZWxzZToKQEAgLTc5MSw4ICs3OTEsOCBAQAogICAgICAgICAgICAgaWYga3JiNV9o
OgogICAgICAgICAgICAgICAgIHNzbF9pbmNzICs9IGtyYjVfaAogICAgICAgICBzc2xfbGlicyA9
IGZpbmRfbGlicmFyeV9maWxlKHNlbGYuY29tcGlsZXIsICdzc2wnLGxpYl9kaXJzLAotICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFsnL3Vzci9sb2NhbC9zc2wvbGliJywKLSAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy91c3IvY29udHJpYi9zc2wvbGli
LycKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbJy91c3IvbG9jYWwvc3Ns
L2xpYjY0JywKKyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJy91c3IvY29u
dHJpYi9zc2wvbGliNjQvJwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0g
KQogCiAgICAgICAgIGlmIChzc2xfaW5jcyBpcyBub3QgTm9uZSBhbmQK
" | base64 -d > $TMP/python3.x86_64.diff

patch -p1 -i $TMP/python3.x86_64.diff || exit 1
fi

# Fixes
sed -i '1s|^#.*/usr/local/bin/python|#!/usr/bin/python3|' Lib/cgi.py
sed -i 's|\("install",\)|\1 "--ignore-installed",|' Lib/ensurepip/__init__.py

echo 
echo "$VERDE"Configurando ..."$CIERRE"
sleep 1  
  
./configure \
  --prefix=/usr \
  --libdir=/usr/lib${LIBDIRSUFFIX} \
  --mandir=/usr/man \
  --docdir=/usr/doc/$PRGNAM-$VERSION \
  --with-threads \
  --enable-ipv6 \
  --enable-shared \
  --with-system-expat \
  --with-system-ffi \
  --build=$ARCH-slackware-linux

echo 
echo "$VERDE"Compilamos ..."$CIERRE"
sleep 1  
  
make  || exit 1
make install DESTDIR=$PKG

# Restore original ensurepip behaviour.
sed -i 's|\("install",\) "--ignore-installed",|\1|' \
  $PKG/usr/lib${LIBDIRSUFFIX}/python${PYVER}/ensurepip/__init__.py

# Remove to avoid overwriting a copy from Python2.
rm -f $PKG/usr/bin/2to3

# We'll install the python-tools under site-packages:
mkdir -p $SITEPK
cp -a Tools/* $SITEPK

# Remove DOS batch/exe files.
find $PKG \( -name '*.exe' -o -name '*.bat' \) -exec rm -f '{}' \;

# Fix permissions on dynamic libraries.
find $PKG -type f -perm 555 -exec chmod 755 '{}' \;
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura
#Comprobamos version instalada del paquete
f_versionInstalada
#Si no existe el fichero se descargara
f_download
#Preparamos entorno
f_preparar
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales