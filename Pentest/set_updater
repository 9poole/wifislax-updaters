#!/bin/sh

# Script by www.seguridadwireless.net

SCRIPT_VERSION=20151116

############################################################
## Funciones comunes. Su nombre empieza por f_ ##
############################################################
f_variables(){
	. /opt/wifislax-updaters/Funciones/funciones_updater
}

############################################################
## Funciones propias del script. Su nombre empieza por F_ ##
############################################################
# Definicion de variables
F_variables() {
	WEB=https://raw.githubusercontent.com/trustedsec/social-engineer-toolkit/master/readme/CHANGES
	VERSION=`curl -s $WEB | grep version | head -1 | cut -d " " -f2 | sed "s/.$//g" | sed "s/ //g"`
	PRGNAM=set
	echo -ne "\033]2;${PRGNAM}_updater\007"
	DESCARGA="git clone https://github.com/trustedsec/social-engineer-toolkit/"
}

# Creamos directorios extra
F_extradirs(){
mkdir -p $PKG/{usr/share/setoolkit,usr/bin,usr/share/pixmaps,usr/share/applications/wifislax/Testing,usr/share/applications/wifislax/Wifislax_documentacion}
}

# Si el paquete no existe se descargara de internet
F_download(){
	echo ""
	echo "$CYAN"Descargando sources de $PRGNAM-$VERSION"$CIERRE"
	echo "$AMARILLO"
	sleep 1
	$DESCARGA $PKG/usr/share/setoolkit
}

# Descomprimimos el fichero descargado y compilamos
F_compilar(){
rm -rf $PKG/usr/share/setoolkit/.git
cp -rf $PKG/usr/share/setoolkit/{setoolkit,seupdate} $PKG/usr/bin/
# Creamos los ficheros desktop
# Documentacion
echo "[Desktop Entry]
Categories=Wifislax Documentacion;
Exec=xdg-open /usr/share/setoolkit/readme/User_Manual.pdf
Icon=application-pdf
MimeType=
Name[es]=Manual de usuario SET
Name=Set user manual
Path=/usr/share/setoolkit/readme/
Terminal=false
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Wifislax_documentacion/Manual_$PRGNAM.desktop



# Set-console
echo "[Desktop Entry]
Categories=testing;
Exec=setoolkit
GenericName=Social engineer toolkit
Icon=set
MimeType=
Name=Set-console
StartupNotify=true
Terminal=true
TerminalOptions=
Type=Application" > $PKG/usr/share/applications/wifislax/Testing/Set_console.desktop



# Creamos el icono
echo "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
YzE0vGABN/4/231OjDfGsbIAAAAASUVORK5CYII=
" | base64 -d > $PKG/usr/share/pixmaps/$PRGNAM.png
}

###################################
## BLOQUE PRINCIPAL DE EJECUCION ##
###################################
# Si se cierra el script inesperadamente, ejecutar la funcion de limpieza
trap f_exitmode SIGHUP SIGINT

#Inicializamos las variables globales
f_variables
#Comprobamos conexion a Internet
f_comprobarConexion
#Inicializamos las variables del script
F_variables
#Creamos directorio de trabajo
f_directorioTemporal
# Creamos directorios extra
F_extradirs
#Mostramos el mensaje de presentacion
f_presentacion
#Comprobamos updates del script
f_comprobarUpdates
#Asignamos o detectamos arquitectura
f_arquitectura noarch
#Comprobamos version instalada del script
f_versionInstalada
#Si no existe el fichero se descargara
F_download
#Descomprimir fichero descargado y compilamos
F_compilar
#Hacemos strip sobre el paquete
f_strip
#Creamos xzm , instalamos y salimos
f_tareasFinales
